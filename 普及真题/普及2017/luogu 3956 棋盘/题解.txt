Dfs。
表示当前到了第i行第j列当前的位置，当前的颜色是什么，当前是否需要魔法冷却，把整个地图的每一个点的每一种状态dfs求一下最短路即可。
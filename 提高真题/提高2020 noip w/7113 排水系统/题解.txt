DAG图，可以用拓扑排序，一层层递推，注意运算要用分数运算和gcd约简。